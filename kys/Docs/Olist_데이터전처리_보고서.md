# Olist 데이터 전처리 파이프라인 보고서

## 1. 개요 및 목표

- **목표** : 불완전한 데이터 제거, 논리적 오류 수정, 이상치 처리 및 분산된 데이터셋의 통합.
- **대상 데이터** : Orders, Items, Sellers, Products, Reviews, Customers, Payments, Geolocation 등 총 9개 테이블.

---

## 2. 데이터 정제

### 2.1. 기간 필터링

데이터의 완결성이 떨어지는 특정 기간의 주문 데이터를 제외했습니다.

- **제외 대상** :
  - 2016년 9월 ~ 12월
  - 2018년 9월 이후
- **결과** : 약 349건의 주문 제거.

### 2.2. 배송 로직 이상치 제거

논리적으로 불가능하거나 데이터 오류로 추정되는 배송 관련 기록을 제거했습니다.

- **제거 조건** :
  1. `운송업체 인수일`이 `고객 배송 완료일`보다 늦은 경우 (Time Travel)
  2. `주문 승인일`이 `운송업체 인수일`보다 늦은 경우
  3. `배송 완료(delivered)` 상태이나 `배송 완료일`이 없는 경우
- **결과** : 약 1,387건의 주문 제거.

### 2.3. 통계적 이상치 제거

책임 구간별 소요 시간이 비정상적으로 긴 데이터를 IQR기준으로 제거했습니다.

**① PG사 책임 구간 (`pg_time`)**

- **정의**: `order_approved_at` - `order_purchase_timestamp`
- **방법**: **결제 수단(payment_type)** 별로 그룹화하여 IQR 분석 수행.
- **기준**: 음수 값 또는 $Q3 + 1.5 \times IQR$ 초과 시 제거.
- **결과**: 약 15,744건 제거 (신용카드, 볼레토 등 결제 수단별 특성 반영).

**② 물류사 책임 구간 (`logistics_time`)**

- **정의**: `order_delivered_customer_date` - `order_delivered_carrier_date`
- **방법**: **상품 카테고리(product_category_name)** 별로 그룹화하여 IQR 분석 수행.
- **기준**: 음수 값 또는 $Q3 + 1.5 \times IQR$ 초과 시 제거.
- **결과**: 약 4,339건 제거 (카테고리별 배송 난이도 반영).

---

## 3. 데이터 통합

여러 테이블로 나뉘어 있던 데이터를 `order_id`를 기준으로 하나의 마스터 테이블로 병합했습니다.

1. **기본 병합**: `Orders` 테이블에 `Items`, `Products`, `Sellers`, `Reviews`, `Customers` 병합.
2. **카테고리 영문 변환**: 포르투갈어 카테고리명을 영문(`product_category_name_english`)으로 변환 테이블과 병합.

---

## 4. 파생변수 생성

분석의 깊이를 더하기 위해 기존 데이터를 활용하여 총 11개의 새로운 변수를 생성했습니다.

| 구분                | 변수명                   | 설명                                                |
| :------------------ | :----------------------- | :-------------------------------------------------- |
| **이벤트**          | `is_black_friday`        | 주문일이 블랙 프라이데이 시즌인지 여부 (Boolean)    |
|                     | `is_carnival`            | 주문일이 브라질 카니발 축제 기간인지 여부 (Boolean) |
| **상품**            | `has_photos`             | 상품 사진 보유 여부                                 |
|                     | `has_description`        | 상품 설명 보유 여부                                 |
|                     | `description_length`     | 상품 설명 길이 (결측 시 0 처리)                     |
| **리뷰**            | `has_text_review`        | 텍스트 리뷰 작성 여부 (내용 존재 시 True)           |
| **위치**            | `is_same_state`          | 판매자와 구매자가 같은 주(State)에 거주하는지 여부  |
| **시간(Lead Time)** | `pg_processing_days`     | PG사 처리 기간 (승인 - 구매)                        |
|                     | `seller_processing_days` | 판매자 출고 기간 (물류사전달 - 승인)                |
|                     | `delivery_days`          | 물류사 배송 기간 (고객수령 - 물류사전달)            |

---

## 5. 최종 결측치 처리 및 마감

통합 과정에서 발생한 결측치와 불필요한 컬럼을 최종 정리했습니다.

- **결측치 처리**:
  - 분석에 치명적인 결측 행 제거.
  - 단, **리뷰 내용(`review_comment_message`)** 이나 **상품 스펙** 관련 결측치는 데이터 특성을 고려하여 **제거하지 않고 유지**했습니다.
- **컬럼 삭제**:
  - 중복되거나 분석에 불필요한 지리 정보(raw lat/lng), 포르투갈어 카테고리명 등 11개 컬럼 삭제.

---

## 6. 최종 데이터셋 요약

모든 전처리 과정을 거친 최종 데이터셋의 현황입니다.

- **데이터 크기**: 85,597 행 / 43 컬럼
- **주요 특징**:
  - **고유 주문 수**: 74,906건
  - **고유 고객 수**: 74,906명
  - **고유 판매자 수**: 2,815명
  - **고유 상품 수**: 27,489개
